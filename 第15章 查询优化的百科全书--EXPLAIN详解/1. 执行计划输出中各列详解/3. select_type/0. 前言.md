# 0. 前言

前文说过,1条大的查询语句中,可以包含若干个`SELECT`关键字,每个`SELECT`关键字代表着1个小的查询语句.
而每个`SELECT`关键字的`FROM`子句中,都可以包含若干张表(这些表用来做连接查询),每张表都对应着执行计划输出中的1条记录.
对于在同一个`SELECT`关键字中的表来说,它们在执行计划中的`id`值是相同的.

在MySQL的执行计划中,`select_type`列表示当前这一行对应的`SELECT`子句在整个查询结构中的类型.也就是MySQL优化器如何对这个子句进行处理.
这里说的**类型**是指**MySQL优化器在整个查询结构中对某个`SELECT`子句所处角色和执行方式的分类**.

换句话说,`select_type`描述的是:**"这个`SELECT`语句在整个SQL查询的层级结构里扮演的角色,以及它在执行计划中被当作哪一类处理"**.

- 为什么要有"类型"这个概念?

    一个查询语句中可能包含:

    - 外层查询(主查询)
    - 子查询(在`WHERE`/`FROM`/`SELECT`里)
    - `UNION`合并查询
    - 派生表(`FROM (SELECT ...) [AS alias]`)
    - 被物化的子查询

    MySQL在执行计划中需要标记**每个`SELECT`子句的身份**,这样才能清楚:

    - 它是最外层的主查询吗?(`PRIMARY`/`SIMPLE`)
    - 它是`UNION`的哪个分支?(`UNION`/`UNCACHEABLE UNION`)
    - 它是派生表吗?(`DERIVED`/`DEPENDENT DERIVED`)
    - 它是相关子查询吗?(`DEPENDENT SUBQUERY`)
    - 它是被物化的吗?(`MATERIALIZED`)

- 类型的具体展现:

    `select_type`的取值如下(为精确起见,此处直接使用文档中的英文做简要描述,后文详细解释):

    |           名称           |                                                    描述                                                     |
    |:----------------------:|:---------------------------------------------------------------------------------------------------------:|
    |        `SIMPLE`        |                               Simple SELECT (not using UNION or subqueries)                               |
    |       `PRIMARY`        |                                             Outermost SELECT                                              |
    |        `UNION`         |                                Second or later SELECT statement in a UNION                                |
    |     `UNION RESULT`     |                                             Result of a UNION                                             |
    |       `SUBQUERY`       |                                         First SELECT in subquery                                          |
    |  `DEPENDENT SUBQUERY`  |                            First SELECT in subquery, dependent on outer query                             |
    |   `DEPENDENT UNION`    |                   Second or later SELECT statement in a UNION, dependent on outer query                   |
    |       `DERIVED`        |                                               Derived table                                               |
    |     `MATERIALIZED`     |                                           Materialized subquery                                           |
    | `UNCACHEABLE SUBQUERY` | A subquery for which the result cannot be cached and must be re-evaluated for each row of the outer query |
    |  `UNCACHEABLE UNION`   | The second or later select in a UNION that belongs to an uncacheable subquery (see UNCACHEABLE SUBQUERY)  |

- 用一个例子看"类型"的含义

    ```
    mysql> EXPLAIN
        -> SELECT * 
        -> FROM single_table
        -> WHERE id IN (
        ->     SELECT id FROM single_table
        ->     UNION
        ->     SELECT id FROM single_table2
        -> );
    +----+--------------------+---------------+------------+--------+---------------+---------+---------+------+------+----------+-----------------+
    | id | select_type        | table         | partitions | type   | possible_keys | key     | key_len | ref  | rows | filtered | Extra           |
    +----+--------------------+---------------+------------+--------+---------------+---------+---------+------+------+----------+-----------------+
    |  1 | PRIMARY            | single_table  | NULL       | ALL    | NULL          | NULL    | NULL    | NULL | 9817 |   100.00 | Using where     |
    |  2 | DEPENDENT SUBQUERY | single_table  | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | func |    1 |   100.00 | Using index     |
    |  3 | DEPENDENT UNION    | single_table2 | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | func |    1 |   100.00 | Using index     |
    |  4 | UNION RESULT       | <union2,3>    | NULL       | ALL    | NULL          | NULL    | NULL    | NULL | NULL |     NULL | Using temporary |
    +----+--------------------+---------------+------------+--------+---------------+---------+---------+------+------+----------+-----------------+
    4 rows in set, 1 warning (0.00 sec)
    ```

    其中:

    - `PRIMARY`: 最外层的主查询(`SELECT * FROM single_table ...`)
    - `DEPENDENT SUBQUERY`: `UNION`的第1个分支
    - `DEPENDENT UNION`: `UNION`的第二个分支
    - `UNION RESULT`: MySQL为`UNION`合并结果生成的临时表

    所以这里的**类型**就是在描述这个`SELECT`:

    - 是不是主查询?
    - 是不是子查询?
    - 是不是派生表?
    - 是不是`UNION`分支?
    - 是不是物化查询?
