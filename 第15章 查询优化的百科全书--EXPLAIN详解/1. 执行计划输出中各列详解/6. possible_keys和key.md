# 6. `possible_keys`和`key`

在EXPLAIN语句输出的执行计划中:

- `possible_keys`列表示在某个查询语句中,对某个表执行单表查询时可能用到的索引有哪些
- `key`列表示实际用到的索引有哪些
  - 这里之所以说"有哪些",是因为有索引合并的情况
  - 这种情况下,一个查询可能会用到多个索引

例如:

```
mysql> EXPLAIN SELECT * FROM single_table WHERE key1 > 'z' AND key3 = 'a';
+----+-------------+--------------+------------+------+-------------------+----------+---------+-------+------+----------+-------------+
| id | select_type | table        | partitions | type | possible_keys     | key      | key_len | ref   | rows | filtered | Extra       |
+----+-------------+--------------+------------+------+-------------------+----------+---------+-------+------+----------+-------------+
|  1 | SIMPLE      | single_table | NULL       | ref  | idx_key3,idx_key1 | idx_key3 | 403     | const |    1 |     5.00 | Using where |
+----+-------------+--------------+------------+------+-------------------+----------+---------+-------+------+----------+-------------+
1 row in set, 1 warning (0.03 sec)
```

该执行计划中:

- `possible_keys`列的值为`idx_key1`和`idx_key3`,表示该查询可能使用到`idx_key1`和`idx_key3`这2个索引
- `key`列的值为`idx_key3`,表示经过查询优化器计算使用不同索引的成本后,决定使用索引`idx_key3`来执行查询成本较低

有一点比较特别:在使用`index`访问方法查询某个表时,`possible_keys`列是空的,而`key`列展示的是实际使用到的索引

例如:

```
mysql> EXPLAIN SELECT key_part2 FROM s1 WHERE key_part3 = 'a';
+----+-------------+-------+------------+-------+---------------+--------------+---------+------+------+----------+--------------------------+
| id | select_type | table | partitions | type  | possible_keys | key          | key_len |ref   | rows | filtered | Extra                    |
+----+-------------+-------+------------+-------+---------------+--------------+---------+------+------+----------+--------------------------+
| 1  | SIMPLE      | s1    | NULL       | index | NULL          | idx_key_part | 909     |NULL  | 9688 | 10.00    | Using where; Using index |
+----+-------------+-------+------------+-------+---------------+--------------+---------+------+------+----------+--------------------------+
1 row in set, 1 warning (0.00 sec)
```

注: 这里贴的是书中的执行计划,因为我的版本为MySQL8.0.42,已经不会出现这个现象了.

注: 这个现象在MySQL8.0.33版本之前的版本中存在.在8.0.33及之后的版本中,`possible_keys`列也会显示索引名称.

这是我的执行计划:

```
mysql> EXPLAIN SELECT key_part2 FROM single_table WHERE key_part3 = 'a';
+----+-------------+--------------+------------+-------+---------------+--------------+---------+------+------+----------+--------------------------+
| id | select_type | table        | partitions | type  | possible_keys | key          | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+--------------+------------+-------+---------------+--------------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | single_table | NULL       | index | idx_key_part  | idx_key_part | 1209    | NULL | 9817 |    10.00 | Using where; Using index |
+----+-------------+--------------+------------+-------+---------------+--------------+---------+------+------+----------+--------------------------+
1 row in set, 1 warning (0.00 sec)
```

注意: **`possible_keys`列中的值并不是越多越好.可能使用的索引越多,查询优化器在计算查询成本时花费的时间就更长.
所以如果条件允许,尽量删除那些用不到的索引**.
