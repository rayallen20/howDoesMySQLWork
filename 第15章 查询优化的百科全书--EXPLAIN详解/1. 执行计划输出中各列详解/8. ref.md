# 8. `ref`

当访问方法为:

- `const`
- `eq_ref`
- `ref`
- `ref_or_null`
- `unique_subquery`
- `index_subquery`

其中之一时(也就是使用索引列进行等值匹配时),`ref`列展示的就是与索引列作等值匹配的是什么.例如:

- 一个常数
- 某个列
- 函数

- 与索引列进行等值匹配的对象为常数

例如:

```
mysql> EXPLAIN SELECT * FROM single_table WHERE key1 = 'a';
+----+-------------+--------------+------------+------+---------------+----------+---------+-------+------+----------+-------+
| id | select_type | table        | partitions | type | possible_keys | key      | key_len | ref   | rows | filtered | Extra |
+----+-------------+--------------+------------+------+---------------+----------+---------+-------+------+----------+-------+
|  1 | SIMPLE      | single_table | NULL       | ref  | idx_key1      | idx_key1 | 403     | const |    1 |   100.00 | NULL  |
+----+-------------+--------------+------------+------+---------------+----------+---------+-------+------+----------+-------+
1 row in set, 1 warning (0.00 sec)
```

可以看到`ref`列的值为`const`,表示在使用`idx_key1`索引执行查询时,与`key1`列作等值匹配的对象是一个常数

- 与索引列进行等值匹配的对象为某个列

```
mysql> EXPLAIN SELECT * FROM single_table INNER JOIN single_table2 ON single_table.id = single_table2.id;
+----+-------------+---------------+------------+--------+---------------+---------+---------+---------------------------------+------+----------+-------+
| id | select_type | table         | partitions | type   | possible_keys | key     | key_len | ref                             | rows | filtered | Extra |
+----+-------------+---------------+------------+--------+---------------+---------+---------+---------------------------------+------+----------+-------+
|  1 | SIMPLE      | single_table  | NULL       | ALL    | PRIMARY       | NULL    | NULL    | NULL                            | 9817 |   100.00 | NULL  |
|  1 | SIMPLE      | single_table2 | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | charset_demo_db.single_table.id |    1 |   100.00 | NULL  |
+----+-------------+---------------+------------+--------+---------------+---------+---------+---------------------------------+------+----------+-------+
2 rows in set, 1 warning (0.00 sec)
```

可以看到对被驱动表`single_table2`的访问方法为`eq_ref`,而对应的`ref`列的值为`charset_demo_db.single_table.id`,
这说明在对被驱动表`single_table2`进行访问时,
与`single_table2`表的`id`作等值匹配的对象就是`charset_demo_db.single_table.id`(注意这里把数据库名也写出来了).

- 与索引列进行等值匹配的对象为函数

例如:

```
mysql> EXPLAIN SELECT * FROM single_table INNER JOIN single_table2 ON single_table2.key1 = UPPER(single_table.key1);
+----+-------------+---------------+------------+------+---------------+----------+---------+------+------+----------+-----------------------+
| id | select_type | table         | partitions | type | possible_keys | key      | key_len | ref  | rows | filtered | Extra                 |
+----+-------------+---------------+------------+------+---------------+----------+---------+------+------+----------+-----------------------+
|  1 | SIMPLE      | single_table  | NULL       | ALL  | NULL          | NULL     | NULL    | NULL | 9817 |   100.00 | NULL                  |
|  1 | SIMPLE      | single_table2 | NULL       | ref  | idx_key1      | idx_key1 | 403     | func |    1 |   100.00 | Using index condition |
+----+-------------+---------------+------------+------+---------------+----------+---------+------+------+----------+-----------------------+
2 rows in set, 1 warning (0.00 sec)
```

执行计划的第2条记录中,可以看到对`single_table2`表采用`ref`访问方法执行查询,该条记录的`ref`列值为`func`,
说明与`single_table2`表的`key1`列进行等值匹配的对象是一个函数
