# 0. 前言

MySQL查询优化器在基于成本和规则对1条查询语句进行优化后,会后生成一个执行计划.该执行计划展示了接下来具体执行查询的方式,例如:

- 多表连接的顺序是什么
- 采用何种访问方法来具体查询每个表

`EXPLAIN`/`DESC`语句用于查看某个查询语句的具体执行计划.

本章的内容就是讲解EXPLAIN语句的各个输出项的作用,从而可以有针对性的提升查询语句的性能.

在具体的查询语句前边加一个`EXPLAIN`/`DESC`关键字,就可以查看该查询语句的执行计划.例如:

```
mysql> EXPLAIN SELECT 1;
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra          |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+
|  1 | SIMPLE      | NULL  | NULL       | NULL | NULL          | NULL | NULL    | NULL | NULL |     NULL | No tables used |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+
1 row in set, 1 warning (0.01 sec)
```

除了以`SELECT`开头的查询语句,其余的`DELETE`/`INSERT`/`REPLACE`/`UPDATE`语句前面都可以加上`EXPLAIN`,
用以查看这些语句的执行计划.只是这里对`SELECT`语句更感兴趣,所以后续内容只会以`SELECT`语句为例来描述`EXPLAIN`语句的用法.

`EXPLAIN`语句输出的各个列的作用如下:

|       列名        |                  描述                   |
|:---------------:|:-------------------------------------:|
|      `id`       | 在一个大的查询语句中,每个`SELECT`关键字都对应1个唯一的 `id` |
|  `select_type`  |          `SELECT`关键字对应的查询的类型          |
|     `table`     |                  表名                   |
|  `partitions`   |                匹配的分区信息                |
|     `type`      |               针对单表的访问方法               |
| `possible_keys` |                可能用到的索引                |
|      `key`      |               实际上使用的索引                |
|    `key_len`    |              实际使用到的索引长度               |
|      `ref`      |      当使用索引列等值查询时,与索引列进行等值匹配的对象信息      |
|     `rows`      |             预估的需要读取的记录条数              |
|   `filtered`    |        某个表经过搜索条件过滤后剩余记录条数的百分比         |
|     `Extra`     |                一些额外的信息                |

本章中后续内容会详细讲解每一列的含义.

本章中的查询语句依旧使用前文说过的`single_table`和`single_table2`表来演示,表结构如下:

```sql
CREATE TABLE single_table (
    id INT NOT NULL AUTO_INCREMENT,
    key1 VARCHAR(100),
    key2 INT,
    key3 VARCHAR(100),
    key_part1 VARCHAR(100),
    key_part2 VARCHAR(100),
    key_part3 VARCHAR(100),
    common_field VARCHAR(100),
    PRIMARY KEY (id),
    KEY idx_key1 (key1),
    UNIQUE KEY idx_key2 (key2),
    KEY idx_key3 (key3),
    KEY idx_key_part(key_part1, key_part2, key_part3)
) Engine=InnoDB CHARSET=utf8mb4;
```

`single_table2`表的结构与`single_table`表相同,只是表名不同.

2张表中各有10000条随机生成的记录(除主键外,其他列的值随机生成).
