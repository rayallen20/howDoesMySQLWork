# 2. 先删除旧记录,再插入新纪录

在不更新主键的情况下,若有任何一个被更新的列:

- 更新前占用的存储空间
- 更新后占用的存储空间

二者大小不一致,则需要:

- 先把这条旧记录从聚簇索引页面中删除
- 再根据更新后列的值,创建一条新的记录,插入到页面中

注意: 这里所说的删除不是`delete mark`操作,而是真正的删除掉.即: 把该条记录从正常记录链表中移除并加入到垃圾链表中,
并且修改页面中相应的统计信息(比如`PAGE_FREE`/`PAGE_GARBAGE`等这些信息).不过,这个场景下(更新操作中删除旧记录这一步的场景),
做真正删除操作的线程并不是在`DELETE`语句中进行`purge`操作时使用的那个专门的线程,而是**由用户线程同步执行**真正的删除操作.
在真正删除后,紧接着就要根据各个列更新后的值,来创建一条新记录,然后把这条新纪录插入到页面中.

注: 可以理解为,操作仍旧是`purge`线程所做的操作,但只是不是由`purge`线程执行异步操作,而是由用户线程执行同步操作.

- 若新创建的记录占用的存储空间,大小不超过旧记录占用的空间,则可以直接重用被加入到垃圾链表中的旧记录所占用的存储空间
- 否则需要在页面中新申请一段空间,供新记录使用
  - 若本页面内已经没有可用的空间,则需要进行页分裂操作,然后再插入新纪录
