# 2. 事务id是怎么生成的

事务id本质上就是一个数字,它的分配策略和前面讲到的[对隐藏列`row_id`(当用户没有为表创建主键和`UNIQUE`键时InnoDB自动创建的列)的分配策略](https://github.com/rayallen20/howDoesMySQLWork/blob/main/%E7%AC%AC19%E7%AB%A0%20%E8%AF%B4%E8%BF%87%E7%9A%84%E8%AF%9D%E5%B0%B1%E4%B8%80%E5%AE%9A%E8%A6%81%E5%81%9A%E5%88%B0--redo%E6%97%A5%E5%BF%97/3.%20redo%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F/1.%20%E7%AE%80%E5%8D%95%E7%9A%84redo%E6%97%A5%E5%BF%97%E7%B1%BB%E5%9E%8B.md)
大致相同,具体策略如下:

- 服务器会在内存中维护一个全局变量,每当需要为某个事务分配事务id时,就会把该变量的值当作事务id分配给该事务,并且把该变量自增1
- 每当该变量的值为256的倍数时,就会将该变量的值刷新到[系统表空间中页号为5的页面](https://github.com/rayallen20/howDoesMySQLWork/blob/main/%E7%AC%AC9%E7%AB%A0%20%E5%AD%98%E6%94%BE%E9%A1%B5%E9%9D%A2%E7%9A%84%E5%A4%A7%E6%B1%A0%E5%AD%90--InnoDB%E7%9A%84%E8%A1%A8%E7%A9%BA%E9%97%B4/3.%20%E7%B3%BB%E7%BB%9F%E8%A1%A8%E7%A9%BA%E9%97%B4/1.%20%E7%B3%BB%E7%BB%9F%E8%A1%A8%E7%A9%BA%E9%97%B4%E7%9A%84%E6%95%B4%E4%BD%93%E7%BB%93%E6%9E%84/0.%20%E6%A6%82%E8%BF%B0.md)(一个类型为`TRX_SYS`的页面)中一个名为`Max Trx ID`的属性中,该属性占8字节的存储空间
- 当系统下一次重新启动时,会将`Max Trx ID`属性的值加载到内存中,将该值加上256之后,赋值给前面提到的全局变量
  - 因为在系统上次关机时,内存中该全局变量的值,可能大于磁盘页面中的`Max Trx ID`属性值,但是还没大到256的倍数(即`全局变量的值 < Max Trx ID + 256`,也就是还没有触发刷盘的机制)

这样就可以保证整个系统中分配的事务id值是一个递增的数字:

- 先分配事务id的事务,得到的是较小的事务id
- 后分配事务id的事务,得到的是较大的事务id
