# 11. 配置`Buffer Pool`时的注意事项

- `innodb_buffer_pool_size`必须是`innodb_buffer_pool_chunk_size * innodb_buffer_pool_instances`的倍数
    
    这是为了确保每个`Buffer Pool`实例中包含的`chunk`数量相同.
    
    假设指定`innodb_buffer_pool_chunk_size`的值为128MB,`innodb_buffer_pool_instances`的值为16,
    则这两个值的乘积为2GB.这也就要求`innodb_buffer_pool_size`的值必须是2GB或2GB的整数倍.例如:
    
    修改系统变量:
    
    ```
    root@mysql-master:~# vim /etc/mysql/mysql.conf.d/mysqld.cnf
    root@mysql-master:~# cat /etc/mysql/mysql.conf.d/mysqld.cnf
    ```

    ```
    [server]
    # 设置InnoDB Buffer Pool的大小为 8GB
    innodb_buffer_pool_size = 8G
    
    # 定义Buffer Pool的数量
    innodb_buffer_pool_instances = 16
    ```
    
    `innodb_buffer_pool_chunk_size`的默认值为128MB,指定的`innodb_buffer_pool_instances`值为16,
    所以`innodb_buffer_pool_size`的值必须是2GB或2GB的整数倍.本例中指定的`innodb_buffer_pool_size`的值为8GB,符合规定,
    所以在服务器启动完成之后,查看该变量的值就是指定的8GB(8589934592字节):
    
    ```
    mysql> SHOW VARIABLES LIKE 'innodb_buffer_pool_size';
    +-------------------------+------------+
    | Variable_name           | Value      |
    +-------------------------+------------+
    | innodb_buffer_pool_size | 8589934592 |
    +-------------------------+------------+
    1 row in set (0.01 sec)
    ```
    
    若指定的`innodb_buffer_pool_size`大于`innodb_buffer_pool_chunk_size * innodb_buffer_pool_instances`,
    但不是`innodb_buffer_pool_chunk_size * innodb_buffer_pool_instances`的整数倍,则服务器会自动
    把`innodb_buffer_pool_size`的值调整为`innodb_buffer_pool_chunk_size * innodb_buffer_pool_instances`的整数倍.
    
    例如: 指定`innodb_buffer_pool_size`的值为9GB:
    
    ```
    root@mysql-master:~# vim /etc/mysql/mysql.conf.d/mysqld.cnf
    root@mysql-master:~# cat /etc/mysql/mysql.conf.d/mysqld.cnf
    ```
    
    ```
    [server]
    # 设置InnoDB Buffer Pool的大小为 9GB
    innodb_buffer_pool_size = 9G
    
    # 定义Buffer Pool的数量
    innodb_buffer_pool_instances = 16
    ```
    
    重启服务后查看`innodb_buffer_pool_size`的值:
    
    ```
    mysql> SHOW VARIABLES LIKE 'innodb_buffer_pool_size';
    +-------------------------+-------------+
    | Variable_name           | Value       |
    +-------------------------+-------------+
    | innodb_buffer_pool_size | 10737418240 |
    +-------------------------+-------------+
    1 row in set (0.01 sec)
    ```
    
    可以看到,服务器自动把`innodb_buffer_pool_size`的值调整为了10G(10737418240字节).

- 在服务器启动时,若`innodb_buffer_pool_chunk_size * innodb_buffer_pool_instances > innodb_buffer_pool_size`,则`innodb_buffer_pool_chunk_size`的值会被服务器自动设置为`innodb_buffer_pool_size / innodb_buffer_pool_instances`

    例如: 在启动服务器时指定的`innodb_buffer_pool_size`的值为2GB,`innodb_buffer_pool_instances`的值为16,`innodb_buffer_pool_chunk_size`的值为256MB
    
    ```
    root@mysql-master:~# vim /etc/mysql/mysql.conf.d/mysqld.cnf
    root@mysql-master:~# cat /etc/mysql/mysql.conf.d/mysqld.cnf
    ```
    
    ```
    [server]
    # 设置InnoDB Buffer Pool的大小为 2GB
    innodb_buffer_pool_size = 2G
    
    # 定义Buffer Pool的数量
    innodb_buffer_pool_instances = 16
    
    # 定义Buffer Pool Chunk的大小为256MB
    innodb_buffer_pool_chunk_size = 256M
    ```
    
    `256MB × 16 = 4GB`,显然`4GB > 2GB`,所以`innodb_buffer_pool_chunk_size`值会被服务器改写为
    `innodb_buffer_pool_size / innodb_buffer_pool_instances`.即: `2GB / 16 = 128M`134217728字节):
    
    ```
    mysql> SHOW VARIABLES LIKE 'innodb_buffer_pool_chunk_size';
    +-------------------------------+-----------+
    | Variable_name                 | Value     |
    +-------------------------------+-----------+
    | innodb_buffer_pool_chunk_size | 134217728 |
    +-------------------------------+-----------+
    1 row in set (0.02 sec)
    ```

`Buffer Pool`的缓冲页除了用来缓存磁盘上的页面以外,还可以存储:

- 锁信息
- 自适应哈希索引
- 等

信息，这些内容就不展开讲了.
