# 2. 产生溢出页的临界点

一个列在存储多少字节之后会成为溢出列呢?

**MySQL中规定1个页中至少存放2行记录**.

至于为什么这么规定我们之后再说,现在看一下这个规定造成的影响.

以之前的`off_page_demo`表为例,它只有1个列`c`,往这个表中插入两条记录,每条记录最少插入多少字节的数据才会需要溢出列呢? 
这得分析一下页中的空间都是如何利用的:

- 每个页除了存放我们的记录以外,也需要存储一些额外的信息,这些额外信息加起来需要136个字节的空间,其他空间都可以被用来存储记录
- 每条记录需要的额外信息是27字节,这27个字节包括如下内容:(注意这只是针对`off_page_demo`表的结构进行的分析,结果并不通用)
  - 2个字节用于存储真实数据的长度
    - 因为行格式是`COMPACT`,列`c`的类型为`VARCHAR(65532)`,所以需要变长字段长度列表
  - 1个字节用于存储列是否是NULL值
    - 因为行格式是`COMPACT`,且列`c`没有被`NOT NULL`修饰,所以需要NULL值列表
  - 5个字节大小的记录头信息
    - 因为行格式是`COMPACT`,`COMPACT`的记录头信息大小固定为5字节 
  - 6个字节的`row_id`列
  - 6个字节的`transaction_id`列
  - 7个字节的`roll_pointer`列

假设一个列的真实数据占用的字节数为`n`,则MySQL规定,若该列不发生溢出现象,需要满足如下不等式:

```
136 + 2 * ( 27 + n ) > 16384
```

注: 存放正常记录的页面和溢出页是2种不同类型的页.对于溢出页来说,并没有规定1个页中至少存放2条记录

解这个不等式,可以得到:

```
n < 8099
```

即: 若一个列中存储的数据小于8099个字节,则该列不会成为溢出列,否则就会成为溢出列.
注意:这个8099只是针对`off_page_demo`表得出的结论.如果表中有多个列,则这个不等式就不成立了.因为变长字段长度列表和NULL值列表的长度都需要重新计算.

这里重点是: 不用关注这个临界点具体值是多少,只要知道如果如果1条记录的某个列中存储的数据占用的字节数非常多时,该列就可能成为溢出列
