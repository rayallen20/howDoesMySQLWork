# 7. 联合索引中最左侧列的等值且最右侧列的等值查询

联合索引`idx_key_part`的示意图如下:

![idx_key_part索引的示意图](./img/idx_key_part索引的示意图.jpg)

SQL如下:

```sql
SELECT *
FROM single_table
WHERE 
    key_part1 = 'a'
AND
    key_part3 = 'c';
```

由于二级索引记录是先按照`key_part1`列的值排序的,所以符合条件`key_part1 = 'a'`的二级索引记录肯定是相邻的.
但是对于符合条件`key_part1 = 'a'`的二级索引记录来说,并不是直接按照`key_part3`列进行排序的.也就是说,
无法根据搜索条件`key_part3 = 'c'`来进一步减少需要扫描的记录数量.如果使用联合索引`idx_key_part`执行查询,
可以定位到符合条件`key_part1 = 'a'`的第一条记录,然后沿着记录所在的单向链表向后扫描,直到某条记录不符合条件`key_part1 = 'a'`为止.

即: 如果使用联合索引`idx_key_part`执行该査询语句,对应的扫描区间就是`key_part1 ∈ ['a', 'a']`,
形成这个扫描区间的边界条件为`key_part1 = 'a'`.与搜索条件`key_part3 = 'c'`无关.

注: 

在使用联合索引`idx_key_part`执行该查询时,虽然搜索条件`key_part3 = 'c'`不能作为形成扫描区间的边界条件,
但是联合索引`idx_key_part`的二级索引记录是包含`key_part3`列的.
因此每当从联合idx_key_part的扫描区间`key_part1 ∈ ['a', 'a']`中获取到一条二级索引记录时,
可以先判断这条二级索引记录是否符合条件`key_part3 = 'c'`.如果符合该条件再执行回表操作,如果不符合就不执行回表操作,直接跳到下一条二级索引记录.
这样可以减少因回表操作而带来的性能损耗(减少了回表的次数),这种优化方式称为索引条件下推(Index Condition Pushdown, 简称ICP).
索引条件下推的特性是在MySQL5.6中引入的,该特性是默认开启的.关于索引条件下推在后续内容中会讲到.
