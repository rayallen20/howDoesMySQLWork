# 5. EXIST或NOT EXISTS子查询的执行

- 若`[NOT] EXISTS`子查询是不相关子查询

    则可以先执行子查询,得出该`[NOT] EXISTS`子查询的结果是TRUE还是FALSE,然后根据子查询的结果,重写原先的查询语句.例如:
    
    ```sql
    SELECT *
    FROM s1 
    WHERE EXISTS (
        SELECT 1
        FROM s2
        WHERE key1 = 'a'
    ) 
    OR key2 > 100;
    ```
    
    因为该语句中的子查询是不相关子查询(`(SELECT 1 FROM s2 WHERE key1 = 'a')`),所以优化器会首先执行该子查询,
    假设该EXISTS子查询的结果为TRUE,则优化器会重写查询为:
    
    ```sql
    SELECT *
    FROM s1 
    WHERE TRUE
    OR key2 > 100;
    ```
    
    进一步简化之后为:
    
    ```sql
    SELECT *
    FROM s1 
    WHERE TRUE;
    ```
    
    那其实该查询语句就相当于:
    
    ```sql
    SELECT *
    FROM s1;
    ```
  
- 若`[NOT] EXISTS`子查询是相关子查询

例如:

```sql
SELECT *
FROM s1 
WHERE EXISTS (
    SELECT 1
    FROM s2
    WHERE s1.common_field = s2.common_field
);
```

该查询只能按直觉上认为的执行方式来执行.不过若`[NOT] EXISTS`子查询中可以使用索引,则查询速度也会加快不少.例如:

```sql
SELECT *
FROM s1 
WHERE EXISTS (
    SELECT 1
    FROM s2
    WHERE s1.common_field = s2.key1
);
```

该查询中的EXISTS子查询中可以使用索引`idx_key1`来加快查询速度.
