# 6. 常量表检测

MySQL的设计者认为以下2种查询运行的特别快:

- 类型1: 查询的表中1条记录没有,或者只有一条记录

    注: 这里描述的表中的记录数量是靠统计数据得知的.前文说过InnoDB的统计数据数据不准确,所以这一条不能用
    于使用InnoDB作为存储引擎的表,只适用于使用MEMORY或者MyISAM存储引擎的表.

- 类型2: 使用主键等值匹配或者唯一二级索引列等值匹配作为搜索条件来查询某个表

MySQL的设计者认为这2种查询花费的时间特别少,少到可以忽略,所以也把通过这2种方式查询的表称为常量表(constant tables).
优化器在分析一个查询语句时:

- 首先执行常量表查询
  - 注意针对常量表的查询在分析阶段就已经执行了
- 然后把查询中涉及到常量表的条件全部替换成常数
- 最后再分析其余表的查询成本

例如:

```sql
SELECT *
FROM table1 INNER JOIN table2
ON table1.column1 = table2.column2 
WHERE table1.primary_key = 1;
```

很明显,该查询可以使用主键和常量值的等值匹配来查询`table1`表.也就是说在该查询中,`table1`表相当于常量表.
在分析对`table2`表的查询成本之前,就会执行对`table1`表的查询,在得到查询结果后,把原查询中涉及`table1`表的条件都替换掉.
也就是说该语句会被转换成:

```sql
SELECT table1表中primary_key = 1的那条记录的各字段常量值, table2.*
FROM table1 INNER JOIN table2
ON table1表中primary_key = 1的那条记录的column1列的常量值 = table2.column2;
```
