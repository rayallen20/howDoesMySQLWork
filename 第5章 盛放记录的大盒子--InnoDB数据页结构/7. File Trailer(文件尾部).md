# 7. `File Trailer`(文件尾部)

InnoDB存储引擎会把数据存储到磁盘上,但是磁盘速度太慢,需要以页为单位把数据加载到内存中处理,
如果该页中的数据在内存中被修改了,那么在修改后的某个时间还需要把数据刷新到磁盘中.
但是,如果在刷新还没有结束时断电该怎么办?

为了检测一个页是否完整(也就是在刷新的时候有没有发生只刷新了一部分情况),InnoDB的设计者在每个页的尾部都加了一个`File Trailer`部分,
这个部分由8个字节组成,可以分成2个小部分:

- 前4个字节代表页的校验和:
  - 这个部分与`File Header`中的校验和相对应的
  - 每当一个页面在内存中发生修改时,在刷新之前就要把修改后的校验和算出来
  - 因为`File Header`在页面的前边,所以`File Header`中的校验和会被首先刷新到磁盘(注意校验和是`File Header`中的第1个字段)
  - 当完全写完后,校验和也会被写到页的尾部
  - 如果页面刷新成功,则页首和页尾的校验和应该是一致的
  - 如果刷新了一部分断电了,那么:
    - 在`File Header`中的校验和就代表着已经修改过的页
    - 在`File Trailer`中的校验和代表着原先的页
    - 二者不同则标志着刷新期间发生了错误

- 后4个字节代表页面被最后修改时对应的LSN的后4字节,正常情况下应该与`File Header`部分的`FIL_PAGE_LSN`的后4字节一致
  - 这个部分也是为了校验页的完整性的,只不过目前还没说LSN是什么,所以先不用管这个属性
