# 5. `Page Header`(页面头部)

InnoDB的设计者们为了能得到存储在数据页中的记录的状态信息,如:

- 数据页中已经存储了多少条记录
- 页目录中存储了多少个槽
- 等

特意在数据页(注意是数据页才有的部分)中定义了一个名为`Page Header`的部分,它是页结构的第2部分,这个部分占用固定的56个字节,**专门存储各种状态信息**

`Page Header`中各字节的具体用途如下:

|         名称          | 占用空间大小 |                                            描述                                            |
|:-------------------:|:------:|:----------------------------------------------------------------------------------------:|
| `PAGE_N_DIR_SLOTS`  |  2字节   |                                        在页面目录中的槽数量                                        |
|   `PAGE_HEAP_TOP`   |  2字节   |                           还未使用的空间最小地址,也就是说从该地址之后就是`Free Space`                           |
|    `PAGE_N_HEAP`    |  2字节   |       第1位表示本记录是否为紧凑型的记录;剩余的15位表示本页的堆中记录数量(包括`Infimum`记录和`Supremum`记录以及标记为"已删除"的记录)       |
|     `PAGE_FREE`     |  2字节   | 各个已删除的记录通过`next_record`组成一个单向链表,这个单链表中的记录所占用的存储空间可以被重新利用;`PAGE_FREE`表示该链表头节点对应记录在页面中的偏移量 |
|   `PAGE_GARBAGE`    |  2字节   |                                       已删除记录占用的字节数                                        |
| `PAGE_LAST_INSERT`  |  2字节   |                                        最后插入记录的位置                                         |
|  `PAGE_DIRECTION`   |  2字节   |                                         记录插入的方向                                          |
| `PAGE_N_DIRECTION`  |  2字节   |                                      一个方向连续插入的记录数量                                       |
|    `PAGE_N_RECS`    |  2字节   |                     该页中记录的数量(不包括`Infimum`记录/`Supremum`记录/被标记为删除的记录)                      |
|  `PAGE_MAX_TRX_ID`  |  8字节   |                                修改当前页的最大事务ID，该值仅在二级索引页面中定义                                |
|    `PAGE_LEVEL`     |  2字节   |                                      当前页在B+树中所处的层级                                       |
|   `PAGE_INDEX_ID`   |  8字节   |                                     索引ID，表示当前页属于哪个索引                                     |
| `PAGE_BTR_SEG_LEAF` |  10字节  |                                B+树叶子节点段的头部信息,仅在B+树的根页面定义                                 |
| `PAGE_BTR_SEG_TOP`  |  10字节  |                                 B+树非叶子段的头部信息,仅在B+树的根页面定义                                 |

到这里,从`PAGE_N_DIR_SLOTS`到`PAGE_LAST_INSERT`以及`PAGE_N_RECS`的意思应该是清楚的

- `PAGE_DIRECTION`: 假如新插入的一条记录的主键值比上一条记录(即上一次插入到当前数据页中的记录)的主键值大,就称这条记录的插入方向是右边;反之则是左边.用来表示最后一条记录插入方向的状态就是`PAGE_DIRECTION`
- `PAGE_N_DIRECTION`: 假设连续几次插入新记录的方向都是一致的,InnoDB会把沿着同一个方向插入记录的条数记下来,这个条数就用`PAGE_N_DIRECTION`这个状态表示
  - 当然,如果最后一条记录的插入方向改变了的话,这个状态的值会被清零重新统计
