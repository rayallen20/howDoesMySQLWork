# 1. 统计数据的存储方式

InnoDB提供了2种存储统计数据的方式,分别是永久性地存储统计数据和非永久性地存储统计数据.

- 永久性的统计数据: 统计数据存储在磁盘上,在服务器重启之后这些统计数据依然存在
- 非永久性的统计数据: 统计数据存储在内存中,当服务器关闭时这些这些统计数据就就被清除掉
  - 等到服务器重启之后,在某些适当的场景下会重新收集这些统计数据

系统变量`innodb_stats_persistent`来控制将统计数据存储在何处.在MySQL5.6.6之前,`innodb_stats_persistent`的值默认是OFF,
也就是说InnoDB的统计数据默认是存储到内存中;之后的版本中`innodb_stats_persistent`的值默认是ON,也就是统计数据默认被存储到磁盘上.

```
mysql> SHOW VARIABLES LIKE 'innodb_stats_persistent';
+-------------------------+-------+
| Variable_name           | Value |
+-------------------------+-------+
| innodb_stats_persistent | ON    |
+-------------------------+-------+
1 row in set (0.01 sec)
```

**InnoDB默认是以表为单位来收集和存储统计数据的**,也就是说可以把某些表的统计数据(以及该表的索引统计数据)存储在磁盘上,
把另一些表的统计数据存储在内存中.在创建和修改表的时候通过指定`STATS_PERSISTENT`属性来指明该表的统计数据存储方式即可:

```
CREATE TABLE 表名 (...) Engine=InnoDB, STATS_PERSISTENT = (1|0);
```

```
ALTER TABLE 表名 Engine=InnoDB, STATS_PERSISTENT = (1|0);
```

当`STATS_PERSISTENT = 1`时,表明要把该表的统计数据永久的存储到磁盘上;
当`STATS_PERSISTENT = 0`时,表明要把该表的统计数据临时的存储到内存中.
若在创建表时未指定`STATS_PERSISTENT`属性,则默认采用系统变量`innodb_stats_persistent`的值作为该属性的值.
