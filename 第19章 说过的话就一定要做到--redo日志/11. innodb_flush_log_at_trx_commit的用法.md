# 11. `innodb_flush_log_at_trx_commit`的用法

为保证事务的持久性,用户线程在事务提交时需要将该事务执行过程中产生的所有`redo`日志都刷新到磁盘上.该要求会明显地降低数据库性能.
若对事务的持久性要求不是那么高,可以修改系统变量`innodb_flush_log_at_trx_commit`的值,该变量有3个可选值:

- 0:

    当该系统变量值为0时,表示在事务提交时不立即向磁盘中同步`redo`日志,而是将"向磁盘同步日志:这个任务交给后台线程处理.
    这样可以明显加快请求处理速度.但是,若事务提交后服务器崩溃,后台线程没能及时将`redo`日志刷到磁盘上,则该事务对页面的修改
    会丢失.

- 1:

    当该系统变量值为1时,表示在事务提交时需要将`redo`日志同步到磁盘.这可以保证事务的持久性.
    系统变量`innodb_flush_log_at_trx_commit`的默认值也是1.

- 2:

    当该系统变量值为2时,表示在事务提交时需要将`redo`日志写到**操作系统的缓冲区**(注意是操作系统的缓冲区,不是[`redo log buffer`](https://github.com/rayallen20/howDoesMySQLWork/blob/main/%E7%AC%AC19%E7%AB%A0%20%E8%AF%B4%E8%BF%87%E7%9A%84%E8%AF%9D%E5%B0%B1%E4%B8%80%E5%AE%9A%E8%A6%81%E5%81%9A%E5%88%B0--redo%E6%97%A5%E5%BF%97/5.%20redo%E6%97%A5%E5%BF%97%E7%9A%84%E5%86%99%E5%85%A5%E8%BF%87%E7%A8%8B/2.%20redo%E6%97%A5%E5%BF%97%E7%BC%93%E5%86%B2%E5%8C%BA.md))中,
    但并不需要保证将日志真正地刷新到磁盘.这种情况下若数据库崩溃了,但操作系统没崩溃,事务的持久性还是可以保证的.
    但是若操作系统也崩溃了,则不能保证持久性了.

```
mysql> SHOW VARIABLES LIKE 'innodb_flush_log_at_trx_commit';
+--------------------------------+-------+
| Variable_name                  | Value |
+--------------------------------+-------+
| innodb_flush_log_at_trx_commit | 1     |
+--------------------------------+-------+
1 row in set (0.03 sec)
```

该系统变量的作用域为`GLOBAL`和`SESSION`级别.
