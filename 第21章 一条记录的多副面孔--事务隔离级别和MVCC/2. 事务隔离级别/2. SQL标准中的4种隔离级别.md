# 2. SQL标准中的4种隔离级别

按照可能导致一致性问题的严重性,给这些现象排序:

```
脏写 > 脏读 > 不可重复读 > 幻读
```

- 脏写: T2的写覆盖了T1的写
- 脏读: T2读到了T1未提交的修改
- 不可重复读: T2在T1的两次读之间,修改了T1读到的数据
- 幻读: T2在T1的两次读之间,插入了符合T1查询条件的新数据

之前说的"舍弃一部分隔离性,来换取一部分性能"在这里就体现为: **设立一些隔离级别,隔离级别越低,就越可能发生越严重的问题**.

有一帮人(不是MySQL的设计者)制定了SQL标准,在标准中设立了4个隔离级别:

- `READ UNCOMMITTED`: 未提交读
  - 个人理解: 事务T2可以读到事务T1未提交的修改
- `READ COMMITTED`: 已提交读
  - 个人理解: 事务T2只能读到事务T1已提交的修改
- `REPEATABLE READ`: 可重复读
  - 个人理解: 事务T2在事务T1的多次读之间,不能修改T1读到的数据,但可以插入符合T1查询条件的新数据
- `SERIALIZABLE`: 可串行化
  - 个人理解: 事务T2在事务T1的多次读之间,不能修改T1读到的数据,也不能插入符合T1查询条件的新数据

SQL标准中规定(是SQL标准中规定,不是MySQL中规定):针对不同的隔离级别,并发事务执行过程中可以发生不同的现象.具体情况如下:

|        隔离级别        | 脏读  | 不可重复读 | 幻读  |
|:------------------:|:---:|:-----:|:---:|
| `READ UNCOMMITTED` | 可能  |  可能   | 可能  |
|  `READ COMMITTED`  | 不可能 |  可能   | 可能  |
| `REPEATABLE READ`  | 不可能 |  不可能  | 可能  |
|   `SERIALIZABLE`   | 不可能 |  不可能  | 不可能 |

即:

- 在`READ UNCOMMITTED`隔离级别下: 可能发生脏读/不可重复读/幻读现象
- 在`READ COMMITTED`隔离级别下: 可能发生不可重复读/幻读现象,不可能发生脏读现象
- 在`REPEATABLE READ`隔离级别下: 可能发生幻读现象,不可能发生脏读/不可重复读现象
- 在`SERIALIZABLE`隔离级别下: 上述各种现象都不可能发生

使用InnoDB作为存储引擎时,无论何种隔离级别,都不可能发生脏写现象.因为对同1行的更新会加排他锁(X锁,后边会讲到).
因为脏写现象对一致性影响过于严重,无论是何种隔离级别,都不允许脏写的情况发生.

注:

其实SQL 92标准中并没有指出脏写现象,此处参照论文`A Critique of ANSI SQL Isolation Levels`引入了脏写现象,是为了更好地理解隔离级别.
在该论文中,还引入了更多可能引发一致性问题的现象,例如:

- 丢失更新
- 读偏斜
- 写偏斜
- 等

以及划分了更详细的隔离级别.
