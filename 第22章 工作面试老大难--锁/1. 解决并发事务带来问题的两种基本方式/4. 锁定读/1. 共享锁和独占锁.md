# 1. 共享锁和独占锁

并发事务的读-读情况并不会引起什么问题,不过对于写-写/读-写或写读这些情况,可能会引起一些问题,需要使用MVCC或者加锁的方式来解决.
在使用加锁的方式来解决问题时,由于:

- 既要允许读-读情况不受影响
- 又要使写-写/读-写/写-读情况中的操作相互阻塞

所以MySQL的设计者给锁分了个类:

- 共享锁(`Shared Lock`): 简称S锁.在事务要读取一条记录时,需要先获取该记录的S锁
- 独占锁(`Exclusive Lock`): 也常称为排他锁,简称X锁.在事务要改动一条记录时,需要先获取该记录的X锁

若事务T1先获取了一条记录的S锁,之后事务T2接着也要访问这条记录:

- 若事务T2想要再获取该记录的S锁,则事务T2也会获得该锁
  - 即: 事务T1和事务T2在该记录上同时持有S锁
  - 注: 这2个事务持有的是同一个S锁的实例
- 若事务T2想要再获取该记录的X锁,则此操作会被阻塞,直到事务T1提交后将S锁释放掉为止

若事务T1首先获取了一条记录的X锁,则之后无论事务T2是想获取该记录的S锁在是X锁,都会被阻塞,直到事务T1提交之后将X锁释放掉为止.

所以S锁和S锁是兼容的,S锁和X锁是不兼容的,X锁和X锁也是不兼容的.如下表:

| 兼容性 | X锁  | S锁  |
|:---:|:---:|:---:|
| X锁  | 不兼容 | 不兼容 |
| S锁  | 不兼容 | 兼容  |

注: 这里的"兼容"可以理解为"可以同时被多个事务持有"
