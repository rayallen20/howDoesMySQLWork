# 4. 支持事务的存储引擎

MySQL中并不是所有存储引擎都支持事务的功能,目前只有InnoDB和NDB存储引擎支持(NDB存储引擎不是这里的重点).
若某个事务中包含的语句要修改某个表中的数据,但是该表使用的存储引擎不支持事务,则对该表所做的修改将无法进行回滚.

现有2个表,`t_innodb`使用支持事务的存储引擎InnoDB,`t_myisam`使用不支持事务的存储引擎MyISAM,它们的建表语句如下:

```sql
CREATE TABLE `t_innodb` (
  `a` int DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```

```sql
CREATE TABLE `t_myisam` (
  `a` int DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```

开启启一个事务,写一条插入语句后再回滚该事务.观察`t_innodb`和`t_myisam`有什么不同:

```
mysql> SELECT * FROM t_innodb;
Empty set (0.00 sec)

mysql> BEGIN;
Query OK, 0 rows affected (0.00 sec)

mysql> INSERT INTO t_innodb VALUES(1);
Query OK, 1 row affected (0.00 sec)

mysql> ROLLBACK;
Query OK, 0 rows affected (0.00 sec)

mysql> SELECT * FROM t_innodb;
Empty set (0.00 sec)
```

可以看到,对于使用支持事务的存储引擎的`t_innodb`表来说,在插入一条记录再回滚后,`t_innodb`就恢复到没有插入记录时的状态了.

再看看`t_myisam`表的现象:

```
mysql> SELECT * FROM t_myisam;
Empty set (0.00 sec)

mysql> BEGIN;
Query OK, 0 rows affected (0.00 sec)

mysql> INSERT INTO t_myisam VALUES(1);
Query OK, 1 row affected (0.01 sec)

mysql> ROLLBACK;
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql> SELECT * FROM t_myisam;
+------+
| a    |
+------+
|    1 |
+------+
1 row in set (0.00 sec)
```

可以看到,虽然使用了`ROLLBACK`语句来回滚事务,但是插入的那条记录还是留在了`t_myisam`表中.
