# 0. 前言

连接查询的成本计算公式如下:

```
连接查询总成本 = 单次访问驱动表的成本 + 驱动表扇出值 * 单次访问被驱动表的成本
```

对于左连接和右连接查询来说,它们的驱动表是固定的,所以只需要分别为驱动表和被驱动表选择成本最低的访问方法,就可以得到最优的查询方案.

可是对于内连接来说,驱动表和被驱动表的位置是可以互换的,因此需要考虑2个方面的问题:

- 当不同的表作为驱动表时,最终的查询成本可能不同,也就是需要考虑最优的表连接顺序
- 然后分别为驱动表和被驱动表选择成本最低的访问方法

很显然,计算内连接查询成本的方式更麻烦一些.下边就以内连接为例来看看如何计算出最优的连接查询方案.

注: 左连接和右连接查询在某些特殊情况下可以被优化为内连接查询,在之后的章节中会提到

例如下面这个查询:

```sql
SELECT *
FROM s1 INNER JOIN s2 
ON
    s1.key1 = s2.common_field 
WHERE
    s1.key2 > 10
AND
    s1.key2 < 1000
AND
    s2.key2 > 1000
AND
    s2.key2 < 2000;
```

可以选择的连接顺序有两种:

- `s1`连接`s2`,即`s1`作为驱动表,`s2`作为被驱动表
- `s2`连接`s1`,即`s2`作为驱动表,`s1`作为被驱动表

查询优化器需要分别考虑这2种情况下的查询成本,然后选取那个成本更低的那个连接顺序,以及该连接顺序下各个表的最优访问方法作为最终的查询计划.
来分别看一下(这里只做定性地分析,不像分析单表查询那样定量分析了).
