# 2. `mysql.engine_cost`表

`engine_cost`表中记录了在存储引擎层进行的一些操作对应的成本常数,具体内容如下:

```
mysql> SELECT * FROM mysql.engine_cost;
+-------------+-------------+------------------------+------------+---------------------+---------+---------------+
| engine_name | device_type | cost_name              | cost_value | last_update         | comment | default_value |
+-------------+-------------+------------------------+------------+---------------------+---------+---------------+
| default     |           0 | io_block_read_cost     |       NULL | 2025-07-14 02:07:51 | NULL    |             1 |
| default     |           0 | memory_block_read_cost |       NULL | 2025-07-14 02:07:51 | NULL    |          0.25 |
+-------------+-------------+------------------------+------------+---------------------+---------+---------------+
2 rows in set (0.00 sec)
```

与`server_cost`相比,`engine_cost`多了两个列:

- `engine_name`:成本常数适用的存储引擎名称.若该值为`default`,则表示对应的成本常数适用于所有的存储引擎
- `device_type`:存储引擎使用的设备类型.这主要是为了区分常规的机械硬盘和固态硬盘
  - 不过在MySQL5.7.22版本中并没有对机械硬盘的成本和固态硬盘的成本作区分,所以该值默认是0
  - 在MySQL8.0.42中也没有区分,所以该值仍然是0

从`engine_cost`表中的内容可以看出,目前支持的存储引擎成本常数只有2个:

|          成本常数名称          | 默认值  |                                                                    描述                                                                    |
|:------------------------:|:----:|:----------------------------------------------------------------------------------------------------------------------------------------:|
|   `io_block_read_cost`   | 1.0  | 从磁盘上读取一个块对应的成本.请注意使用的是"块",而不是"页".对于InnoDB存储引擎来说,1个"页"就是1个块;不过对于MyISAM存储引擎来说,默认是以4096字节作为一个块的.增大这个值会加重I/O成本,可能让优化器更倾向于选择使用索引(而不是全表扫描)执行查询 |
| `memory_block_read_cost` | 0.25 |                                                     与上一个成本常数类似,只不过衡量的是从内存中读取1个块对应的成本                                                     |

注: 这2个成本常数在MySQL5.7.22中,默认值都是1.0.

为什么从内存中和从磁盘上读取一个块的默认成本是一样的?
这可能是因为在当时MySQL的实现中,并不能准确预测某个查询需要访问的块中,有哪些块已经加载到内存中,有哪些块还停留在磁盘上,
所以MySQL的设计者很粗暴的认为无论这个块是否已被加载到内存中,使用的成本都是1.0.不过随着MySQL的发展,
等到后续版本可以准确预测哪些块在磁盘上,哪些块在内存中时,这2个成本常数的默认值就不一致了.

与更新`server_cost`表中的记录一样,也可以通过更新`engine_cost`表中的记录来更改关于存储引擎的成本常数.
我们也可以通过为`engine_cost`表插入新记录的方式来添加只针对某种存储引擎的成本常数:

- 步骤1. 插入针对某个存储引擎的成本常数

比如想增大InnoDB存储引擎页面I/O的成本,书写正常的插入语句即可:

```sql
INSERT INTO mysql.engine_cost
VALUES ('InnoDB', 0, 'io_block_read_cost', 2.0, CURRENT_TIMESTAMP, 'increase Innodb I/O cost');
```

- 步骤2. 让系统重新加载`engine_cost`表的值

```sql
FLUSH OPTIMIZER_COSTS;
```
